<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>🔍 Search Functionality Test - Skippy AI</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        line-height: 1.6;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
      }
      .section {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .test-btn {
        background: linear-gradient(45deg, #4caf50, #45a049);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
        transition: all 0.3s ease;
      }
      .test-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
      }
      .test-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }
      .result-area {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        min-height: 200px;
        font-family: "Courier New", monospace;
        white-space: pre-wrap;
        max-height: 500px;
        overflow-y: auto;
      }
      .status {
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .status.success {
        background: rgba(76, 175, 80, 0.3);
      }
      .status.error {
        background: rgba(244, 67, 54, 0.3);
      }
      .status.warning {
        background: rgba(255, 193, 7, 0.3);
      }
      .status.info {
        background: rgba(33, 150, 243, 0.3);
      }
      h1 {
        text-align: center;
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🔍 Search Functionality Test</h1>
      <p style="text-align: center; font-size: 1.1em; opacity: 0.9">
        Comprehensive testing for Skippy AI's enhanced search capabilities
      </p>

      <!-- Setup Section -->
      <div class="section">
        <h2>🚀 Setup & Preparation</h2>
        <p>Before testing search, let's set up some sample data:</p>
        <button class="test-btn" onclick="setupSampleData()">
          📊 Add Sample Data
        </button>
        <button class="test-btn" onclick="checkCurrentData()">
          📋 Check Current Data
        </button>
        <button class="test-btn" onclick="clearAllData()">
          🗑️ Clear All Data
        </button>
      </div>

      <!-- Search Tests Section -->
      <div class="section">
        <h2>🔍 Search Tests</h2>
        <p>Test different search scenarios:</p>

        <h3>Programming Content Searches:</h3>
        <button
          class="test-btn"
          onclick="testSearch('find all my programming materials')"
        >
          🔍 Find Programming Materials
        </button>
        <button
          class="test-btn"
          onclick="testSearch('what notes do I have about JavaScript')"
        >
          📝 JavaScript Notes
        </button>
        <button
          class="test-btn"
          onclick="testSearch('search for Python content')"
        >
          🐍 Python Content
        </button>

        <h3>AI & Technology Searches:</h3>
        <button class="test-btn" onclick="testSearch('find AI flashcards')">
          🤖 AI Flashcards
        </button>
        <button
          class="test-btn"
          onclick="testSearch('show me machine learning notes')"
        >
          🧠 ML Notes
        </button>

        <h3>Schedule Searches:</h3>
        <button
          class="test-btn"
          onclick="testSearch('what study sessions do I have')"
        >
          📅 Study Sessions
        </button>
        <button
          class="test-btn"
          onclick="testSearch('show my programming schedule')"
        >
          ⏰ Programming Schedule
        </button>

        <h3>General Searches:</h3>
        <button
          class="test-btn"
          onclick="testSearch('find everything about programming')"
        >
          🔍 Everything Programming
        </button>
        <button
          class="test-btn"
          onclick="testSearch('search my study materials')"
        >
          📚 All Study Materials
        </button>
      </div>

      <!-- Custom Search Section -->
      <div class="section">
        <h2>✍️ Custom Search Test</h2>
        <p>Enter your own search query:</p>
        <input
          type="text"
          id="customSearch"
          placeholder="e.g., find notes about algorithms"
          style="
            width: 70%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            margin-right: 10px;
          "
        />
        <button class="test-btn" onclick="testCustomSearch()">
          🔍 Test Search
        </button>
      </div>

      <!-- Status Display -->
      <div class="section">
        <h2>📊 Test Status</h2>
        <div id="status" class="status info">
          Ready to test! Click setup buttons above to begin.
        </div>
      </div>

      <!-- Results Display -->
      <div class="section">
        <h2>📋 Test Results</h2>
        <div class="result-area" id="results">
          Welcome to the Search Functionality Test! 📝 Instructions: 1. First,
          click "Add Sample Data" to create test content 2. Then try any of the
          search test buttons 3. Check the results below 4. Try custom searches
          in the input field 🎯 What we're testing: • Enhanced search across
          notes, flashcards, and schedule • Content preview and suggestions •
          Intelligent result filtering • Error handling and user feedback
        </div>
      </div>
    </div>

    <script>
      let isSearchReady = false;

      // Check if universalAI is available
      function checkSearchAvailability() {
        if (typeof universalAI !== "undefined") {
          setStatus("✅ Search system ready!", "success");
          isSearchReady = true;
          return true;
        } else {
          setStatus(
            "⚠️ UniversalAI not found. Please open your Skippy AI app first.",
            "warning"
          );
          isSearchReady = false;
          return false;
        }
      }

      // Set status message
      function setStatus(message, type = "info") {
        const statusEl = document.getElementById("status");
        statusEl.textContent = message;
        statusEl.className = `status ${type}`;
      }

      // Update results
      function updateResults(content) {
        const resultsEl = document.getElementById("results");
        resultsEl.textContent = content;
      }

      // Setup sample data
      function setupSampleData() {
        setStatus("📊 Adding sample data...", "info");

        const sampleNotes = [
          {
            id: "note-js-1",
            title: "JavaScript Fundamentals",
            content:
              "JavaScript is a programming language that enables interactive web pages. Key concepts include variables, functions, objects, and event handling.",
            category: "programming",
            tags: ["javascript", "web development", "programming"],
            createdAt: new Date().toISOString(),
            source: "Manual",
          },
          {
            id: "note-ai-1",
            title: "Artificial Intelligence Basics",
            content:
              "AI is the simulation of human intelligence in machines. Machine learning is a subset of AI that enables computers to learn without being explicitly programmed.",
            category: "ai",
            tags: [
              "artificial intelligence",
              "machine learning",
              "programming",
            ],
            createdAt: new Date().toISOString(),
            source: "Manual",
          },
          {
            id: "note-python-1",
            title: "Python Programming",
            content:
              "Python is a high-level programming language known for its simplicity and readability. It is widely used in data science, web development, and automation.",
            category: "programming",
            tags: ["python", "programming", "data science"],
            createdAt: new Date().toISOString(),
            source: "Manual",
          },
        ];

        const sampleFlashcards = [
          {
            id: "card-js-1",
            question: "What is JavaScript?",
            answer:
              "JavaScript is a programming language that enables interactive web pages and is commonly used for client-side web development.",
            category: "programming",
            createdAt: new Date().toISOString(),
          },
          {
            id: "card-ai-1",
            question: "What is Machine Learning?",
            answer:
              "Machine Learning is a subset of AI that enables computers to learn and improve from experience without being explicitly programmed.",
            category: "ai",
            createdAt: new Date().toISOString(),
          },
          {
            id: "card-python-1",
            question: "What makes Python popular?",
            answer:
              "Python is popular due to its simple syntax, readability, extensive libraries, and versatility in various domains.",
            category: "programming",
            createdAt: new Date().toISOString(),
          },
        ];

        const sampleSchedule = [
          {
            id: "schedule-1",
            title: "JavaScript Study Session",
            date: new Date(Date.now() + 24 * 60 * 60 * 1000)
              .toISOString()
              .split("T")[0],
            time: "10:00",
            type: "study",
            priority: "high",
          },
          {
            id: "schedule-2",
            title: "Python Programming Practice",
            date: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000)
              .toISOString()
              .split("T")[0],
            time: "14:00",
            type: "study",
            priority: "medium",
          },
        ];

        try {
          // Get existing data and merge
          const existingNotes = JSON.parse(
            localStorage.getItem("skippy-notes") || "[]"
          );
          const existingFlashcards = JSON.parse(
            localStorage.getItem("skippy-flashcards") || "[]"
          );
          const existingSchedule = JSON.parse(
            localStorage.getItem("skippy-schedule") || "[]"
          );

          // Add sample data (avoid duplicates)
          const mergedNotes = [...existingNotes];
          sampleNotes.forEach((note) => {
            if (!existingNotes.find((n) => n.title === note.title)) {
              mergedNotes.push(note);
            }
          });

          const mergedFlashcards = [...existingFlashcards];
          sampleFlashcards.forEach((card) => {
            if (!existingFlashcards.find((c) => c.question === card.question)) {
              mergedFlashcards.push(card);
            }
          });

          const mergedSchedule = [...existingSchedule];
          sampleSchedule.forEach((item) => {
            if (!existingSchedule.find((s) => s.title === item.title)) {
              mergedSchedule.push(item);
            }
          });

          localStorage.setItem("skippy-notes", JSON.stringify(mergedNotes));
          localStorage.setItem(
            "skippy-flashcards",
            JSON.stringify(mergedFlashcards)
          );
          localStorage.setItem(
            "skippy-schedule",
            JSON.stringify(mergedSchedule)
          );

          setStatus("✅ Sample data added successfully!", "success");
          updateResults(`📊 SAMPLE DATA ADDED SUCCESSFULLY!
                
📝 Total Notes: ${mergedNotes.length}
🎴 Total Flashcards: ${mergedFlashcards.length}
📅 Total Schedule Items: ${mergedSchedule.length}

🎯 Ready to test search! Try the search buttons above.`);
        } catch (error) {
          setStatus("❌ Error adding sample data: " + error.message, "error");
        }
      }

      // Check current data
      function checkCurrentData() {
        try {
          const notes = JSON.parse(
            localStorage.getItem("skippy-notes") || "[]"
          );
          const flashcards = JSON.parse(
            localStorage.getItem("skippy-flashcards") || "[]"
          );
          const schedule = JSON.parse(
            localStorage.getItem("skippy-schedule") || "[]"
          );

          let output = `📊 YOUR CURRENT STUDY DATA
=================================

📝 NOTES (${notes.length} found):
`;
          if (notes.length > 0) {
            notes.slice(0, 5).forEach((note, i) => {
              output += `${i + 1}. ${note.title || "Untitled"} - ${
                note.category || "No category"
              }
   ${(note.content || "").substring(0, 80)}...

`;
            });
          } else {
            output +=
              '   No notes found. Click "Add Sample Data" to create test content.\n\n';
          }

          output += `🎴 FLASHCARDS (${flashcards.length} found):
`;
          if (flashcards.length > 0) {
            flashcards.slice(0, 3).forEach((card, i) => {
              output += `${i + 1}. Q: ${card.question || "No question"}
   A: ${(card.answer || "").substring(0, 60)}...

`;
            });
          } else {
            output +=
              '   No flashcards found. Click "Add Sample Data" to create test content.\n\n';
          }

          output += `📅 SCHEDULE (${schedule.length} found):
`;
          if (schedule.length > 0) {
            schedule.slice(0, 3).forEach((item, i) => {
              output += `${i + 1}. ${item.title} - ${item.date} ${
                item.time || ""
              }

`;
            });
          } else {
            output +=
              '   No schedule items found. Click "Add Sample Data" to create test content.\n\n';
          }

          updateResults(output);
          setStatus(
            `📊 Data check complete: ${
              notes.length + flashcards.length + schedule.length
            } total items`,
            "info"
          );
        } catch (error) {
          setStatus("❌ Error checking data: " + error.message, "error");
        }
      }

      // Clear all data
      function clearAllData() {
        if (
          confirm(
            "Are you sure you want to clear all study data? This cannot be undone."
          )
        ) {
          localStorage.removeItem("skippy-notes");
          localStorage.removeItem("skippy-flashcards");
          localStorage.removeItem("skippy-schedule");
          localStorage.removeItem("buddy-memory");

          setStatus("✅ All data cleared!", "success");
          updateResults(
            "🗑️ All study data has been cleared.\n\nYou can now add sample data and test search functionality."
          );
        }
      }

      // Test search with specific query
      function testSearch(query) {
        if (!checkSearchAvailability()) {
          updateResults(
            "❌ Cannot test search - UniversalAI not available.\n\nPlease:\n1. Open your Skippy AI app (http://localhost:8081)\n2. Wait for it to load completely\n3. Then come back to this test page"
          );
          return;
        }

        setStatus(`🔍 Testing search: "${query}"`, "info");
        updateResults(`🔍 TESTING SEARCH: "${query}"
==================================

⏳ Processing search request...
Please wait for results...`);

        try {
          universalAI
            .processAnyPrompt({ text: query })
            .then((result) => {
              setStatus("✅ Search completed successfully!", "success");

              let output = `🔍 SEARCH RESULTS FOR: "${query}"
${"=".repeat(50)}

📋 SUMMARY:
${result.summary || "No summary provided"}

`;

              if (result.artifacts) {
                if (
                  result.artifacts.notes &&
                  result.artifacts.notes.length > 0
                ) {
                  output += `📝 NOTES FOUND (${result.artifacts.notes.length}):
`;
                  result.artifacts.notes.forEach((note, i) => {
                    output += `${i + 1}. ${note.title || "Untitled"}
   Category: ${note.category || "No category"}
   Preview: ${(note.content || "").substring(0, 100)}...

`;
                  });
                }

                if (
                  result.artifacts.flashcards &&
                  result.artifacts.flashcards.length > 0
                ) {
                  output += `🎴 FLASHCARDS FOUND (${result.artifacts.flashcards.length}):
`;
                  result.artifacts.flashcards.forEach((card, i) => {
                    output += `${i + 1}. Q: ${card.question || "No question"}
   A: ${(card.answer || "").substring(0, 80)}...

`;
                  });
                }

                if (
                  result.artifacts.schedule &&
                  result.artifacts.schedule.length > 0
                ) {
                  output += `📅 SCHEDULE ITEMS FOUND (${result.artifacts.schedule.length}):
`;
                  result.artifacts.schedule.forEach((item, i) => {
                    output += `${i + 1}. ${item.title} - ${item.date} ${
                      item.time || ""
                    }

`;
                  });
                }
              }

              output += `
🎯 SEARCH TEST RESULT: ✅ SUCCESS
The enhanced search functionality is working correctly!`;

              updateResults(output);
            })
            .catch((error) => {
              setStatus("❌ Search failed: " + error.message, "error");
              updateResults(`❌ SEARCH FAILED
=================

Query: "${query}"
Error: ${error.message}

🔧 Troubleshooting:
1. Make sure you have sample data (click "Add Sample Data")
2. Check that you're on the Skippy AI page
3. Verify the universalAI is loaded
4. Try refreshing both pages`);
            });
        } catch (error) {
          setStatus("❌ Search error: " + error.message, "error");
          updateResults(`❌ SEARCH ERROR: ${error.message}`);
        }
      }

      // Test custom search
      function testCustomSearch() {
        const query = document.getElementById("customSearch").value.trim();
        if (!query) {
          setStatus("⚠️ Please enter a search query", "warning");
          return;
        }
        testSearch(query);
      }

      // Handle Enter key in search input
      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("customSearch")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              testCustomSearch();
            }
          });

        // Initial check
        checkSearchAvailability();
      });
    </script>
  </body>
</html>
